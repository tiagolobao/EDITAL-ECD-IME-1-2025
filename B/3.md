## 3 - Noções de correlação e regressão linear simples

- Para simplificar, o coeficiente de correlação varia entre 0 e 1, ou -1 e 1.

- Resíduos são as diferenças entre os valores observados nos dados e os valores previstos pelo modelo estatístico.

- A formula para o qui-quadrado de Pearson pode ser escrito: χ2 = ∑Ei ( ( Oi − Ei )^2 / Ei )
   - Oi => Valor observado
   - Ei => Valor esperado

> O valor esperado vai ser calculado baseado em na ideia de que as frequencias em porcentagem para cada observacao deveria ser igual, caso nao existisse correlação entre as variaveis.
Por exemplo: se em duas diferentes cidades, 40% das pessoas sao mais altas que 170cm, é esperado que cada cidade tenha 20% das pessoas mais altas que 170cm, se fingirmos que nao existe relação entre as variaveis cidade e altura

- Para comparacoes (limitar para o intervalo 0 |- 1), sao utilizados os seguintes coeficientes

  - coeficiente de contingencia: C = sqrt ( χ2 / n + χ2 )
  - coeficiente de Tschuprov: T = sqrt ( χ2 / n * sqrt((r-1)(s-1))
  - coeficiente de Cramér: V = sqrt ( χ2 / n(q-1) )

## Questoes

7. Usando os valores da tabela `questao_2.csv`,

  **(a) Construa a distribuição de frequência conjunta para as variáveis grau de instrução e região de procedência.**

```python
import pandas
import numpy
dados = pandas.read_csv("questao_2.csv")

# calculando manualmente
regioes = dados["Regiao_de_procedencia"].str.strip()
graus = dados["Grau_de_instrucao"].str.strip()
dict_tabela = {regiao: {grau: 0 for grau in graus.unique()} for regiao in regioes.unique()}

for regiao, grau in zip(regioes,graus):
    dict_tabela[regiao][grau] += 1

# usando pandas, para conferencia
tabela_conjunta = pandas.crosstab(regioes,graus)
print(tabela_conjunta)

```

Regiao_de_procedencia / Grau_de_instrucao   |    ensino fundamental | ensino médio | superior | Total
--------------------------------------------|-----------------------|--------------|----------|--------
capital                                     |                    4  |           5  |       2  |    11
interior                                    |                    3  |           7  |       2  |    12
outra                                       |                    5  |           6  |       2  |    13
Total                                       |                    12 |          18  |       6  |

  **(b) Qual a porcentagem de funcionários que têm o ensino médio?**

```python
porcentagem_ensino_medio = ( 18 / (12 + 18 + 6) ) * 100
print(f"{porcentagem_ensino_medio}% dos funcionários têm ensino medio")
# 50.0% dos funcionários têm ensino medio
```

  **(c) Qual a porcentagem daqueles que têm o ensino médio e são do interior?**

```python
porcentagem_ensino_medio_interior = ( 7 / (12 + 18 + 6) ) * 100
print(f"{porcentagem_ensino_medio_interior:.2f}% dos funcionários têm ensino medio e são do interior")
# 19.44% dos funcionários têm ensino medio e sao do interior
```

  **(d) Dentre os funcionários do interior, quantos por cento têm o ensino médio?**

```python
porcentagem_ensino_medio_interior = ( 7 / 18 ) * 100
print(f"{porcentagem_ensino_medio_interior:.2f}% dos funcionários que têm ensino medio são do interior")
# 38.89% dos funcionários que têm ensino medio são do interior
```

  **(e) Calcule o valor de χ2 e o coeficiente de contingência C.**

```python
# χ2 = ∑Ei ( ( Oi − Ei )^2 / Ei )
# C = sqrt ( χ2 / n + χ2 )

import pandas
from numpy import sqrt

dados = pandas.read_csv("./B/questao_2.csv")
regioes = dados["Regiao_de_procedencia"].str.strip()
graus = dados["Grau_de_instrucao"].str.strip()

dict_tabela_observados = {
    regiao: {grau: 0 for grau in graus.unique()} for regiao in regioes.unique()
}
for regiao, grau in zip(regioes, graus):
    dict_tabela_observados[regiao][grau] += 1

dict_porcentagem_esperada_por_regiao = {}
for regiao, count in regioes.value_counts().items():
    dict_porcentagem_esperada_por_regiao[regiao] = count / regioes.count()

dict_tabela_esperados = {
    regiao: {grau: 0 for grau in graus.unique()} for regiao in regioes.unique()
}
for regiao, grau in zip(regioes, graus):
    dict_tabela_esperados[regiao][grau] = (
        dict_porcentagem_esperada_por_regiao[regiao] * graus.value_counts()[grau]
    )

qui_quadrado = 0
for regiao, graus_na_regiao in dict_tabela_observados.items():
    for grau, observacao in graus_na_regiao.items():
        qui_quadrado += (
            pow(observacao - dict_tabela_esperados[regiao][grau], 2)
            / dict_tabela_esperados[regiao][grau]
        )

print(f"o value X2 (qui quadrado) e: {qui_quadrado}")

contingencia = sqrt(qui_quadrado / (qui_quadrado + regioes.count()))
print(f"o valor C e: {contingencia}")

# o value X2 (qui quadrado) e: 0.6614219114219113
# o valor C e: 0.13431812988770833
```
